<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MP3 Player</title>
    <style>
        /* „ÉÄ„Éº„ÇØ„Éû„ÉÜ„É™„Ç¢„É´„Éá„Ç∂„Ç§„É≥ */
        body {
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #121212, #1e1e1e);
            margin: 0;
            color: white;
            transition: background 1s;
        }

        .player-container {
            text-align: center;
            background: rgba(40, 40, 40, 0.9);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            margin: 20px;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 24px;
        }

        button, input[type="file"] {
            padding: 12px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
        }

        button {
            background: #6200ea;
            color: white;
            margin: 10px 0;
            box-shadow: 0 4px 10px rgba(98, 0, 234, 0.5);
        }

        button:hover {
            background: #7b1fa2;
            box-shadow: 0 6px 12px rgba(123, 31, 162, 0.5);
        }

        #stopBtn {
            background: #d32f2f;
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.5);
        }

        #stopBtn:hover {
            background: #b71c1c;
            box-shadow: 0 6px 12px rgba(183, 28, 28, 0.5);
        }

        /* Ê≥¢ÂΩ¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .wave-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            height: 50px;
        }

        .wave {
            width: 8px;
            height: 30px;
            margin: 0 4px;
            background: #03dac6;
            animation: wave-animation 1s infinite ease-in-out;
        }

        .wave:nth-child(2) {
            animation-delay: 0.2s;
        }

        .wave:nth-child(3) {
            animation-delay: 0.4s;
        }

        .wave:nth-child(4) {
            animation-delay: 0.6s;
        }

        .wave:nth-child(5) {
            animation-delay: 0.8s;
        }

        @keyframes wave-animation {
            0%, 100% {
                height: 20px;
                background: #03dac6;
            }
            50% {
                height: 40px;
                background: #bb86fc;
            }
        }

        @keyframes wave2-animation {
            0%, 100% {
                height: 20px;
                background: #ff9800;
            }
            50% {
                height: 40px;
                background: #ff5722;
            }
        }

        @keyframes wave3-animation {
            0%, 100% {
                height: 20px;
                background: #4caf50;
            }
            50% {
                height: 40px;
                background: #8bc34a;
            }
        }

        .hidden {
            display: none;
        }

        /* „Ç∑„Éº„ÇØ„Éê„Éº */
        #seekBar {
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
        }

        /* ÂÜçÁîüÊôÇÈñì„Å®ÁèæÂú®„ÅÆÂÜçÁîü‰ΩçÁΩÆ */
        #timeDisplay {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-top: 10px;
        }

        /* Êñ∞„Åó„ÅÑ„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .control-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .control-buttons button {
            flex-grow: 1;
            margin: 5px;
            width: auto;
        }

        /* „Ç§„Ç≥„É©„Ç§„Ç∂„Éº */
        .equalizer {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
        }

        .eq-bar {
            width: 10px;
            background: #03dac6;
            transition: height 0.3s;
        }

        .eq-bar:nth-child(1) { height: 20px; }
        .eq-bar:nth-child(2) { height: 30px; }
        .eq-bar:nth-child(3) { height: 40px; }

        /* ËÉåÊôØ„Ç®„Éï„Çß„ÇØ„Éà */
        body.playing {
            background: linear-gradient(135deg, #121212, #3700B3);
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1>MP3 Player</h1>
        <input type="file" id="fileInput" accept="audio/*" multiple>
        <div class="control-buttons">
            <button id="playBtn">‚ñ∂ Play</button>
            <button id="pauseBtn">‚è∏ Pause</button>
            <button id="stopBtn">‚èπ Stop</button>
            <button id="repeatBtn">üîÅ Repeat</button>
            <button id="autoPlayBtn">üîÑ Auto Play</button>
        </div>
        <audio id="audioPlayer" class="hidden"></audio>

        <!-- „Ç∑„Éº„ÇØ„Éê„Éº -->
        <input type="range" id="seekBar" value="0" step="0.1" min="0" max="100">

        <!-- ÂÜçÁîüÊôÇÈñì„Å®ÁèæÂú®„ÅÆÂÜçÁîü‰ΩçÁΩÆ -->
        <div id="timeDisplay">
            <span id="currentTime">00:00</span>
            <span id="duration">00:00</span>
        </div>

        <!-- „Ç§„Ç≥„É©„Ç§„Ç∂„Éº -->
        <div class="equalizer">
            <div class="eq-bar" id="eq1"></div>
            <div class="eq-bar" id="eq2"></div>
            <div class="eq-bar" id="eq3"></div>
        </div>

        <!-- Ê≥¢ÂΩ¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
        <div class="wave-container hidden" id="waveAnimation">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        const waveAnimation = document.getElementById('waveAnimation');
        const seekBar = document.getElementById('seekBar');
        const currentTimeDisplay = document.getElementById('currentTime');
        const durationDisplay = document.getElementById('duration');
        const eq1 = document.getElementById('eq1');
        const eq2 = document.getElementById('eq2');
        const eq3 = document.getElementById('eq3');

        let selectedFiles = [];
        let currentFileIndex = 0;
        let isRepeat = false;
        let isAutoPlay = false;
        let currentAnimation = 'wave';

        const animations = ['wave', 'wave2', 'wave3'];

        // „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
        fileInput.addEventListener('change', function(event) {
            selectedFiles = Array.from(event.target.files);
            loadFile(0);
        });

        // „Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄ
        function loadFile(index) {
            if (selectedFiles[index]) {
                currentFileIndex = index;
                const fileURL = URL.createObjectURL(selectedFiles[index]);
                audioPlayer.src = fileURL;
                audioPlayer.load();
                audioPlayer.pause();
                updateDurationDisplay();
                Android.onFileSelected(fileURL);
            }
        }

        // ÂÜçÁîü„Éú„Çø„É≥
        playBtn.addEventListener('click', function() {
            if (selectedFiles.length > 0) {
                audioPlayer.play();
                document.body.classList.add('playing');
                showWaveAnimation();
                playBtn.textContent = '‚è∏ Pause';
                updateNotification('PLAY');
                Android.playAudio(audioPlayer.src);
            } else {
                alert("Please select an MP3 file first.");
            }
        });

        // ‰∏ÄÊôÇÂÅúÊ≠¢„Éú„Çø„É≥
        pauseBtn.addEventListener('click', function() {
            audioPlayer.pause();
            document.body.classList.remove('playing');
            hideWaveAnimation();
            playBtn.textContent = '‚ñ∂ Play';
            updateNotification('PAUSE');
            Android.pauseAudio();
        });

        // ÂÅúÊ≠¢„Éú„Çø„É≥
        stopBtn.addEventListener('click', function() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            document.body.classList.remove('playing');
            hideWaveAnimation();
            playBtn.textContent = '‚ñ∂ Play';
            updateNotification('STOP');
            Android.stopAudio();
        });

        // „É™„Éî„Éº„Éà„Éú„Çø„É≥
        repeatBtn.addEventListener('click', function() {
            isRepeat = !isRepeat;
            repeatBtn.style.backgroundColor = isRepeat ? '#FF6F00' : '#6200ea';
        });

        // „Ç™„Éº„Éà„Éó„É¨„Ç§„Éú„Çø„É≥
        autoPlayBtn.addEventListener('click', function() {
            isAutoPlay = !isAutoPlay;
            autoPlayBtn.style.backgroundColor = isAutoPlay ? '#FF6F00' : '#6200ea';
        });

        // ÂÜçÁîüÁµÇ‰∫ÜÂæå„ÅÆÂá¶ÁêÜ
        audioPlayer.addEventListener('ended', function() {
            if (isRepeat) {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else if (isAutoPlay && currentFileIndex < selectedFiles.length - 1) {
                loadFile(++currentFileIndex);
                audioPlayer.play();
            } else {
                hideWaveAnimation();
                playBtn.textContent = '‚ñ∂ Play';
                document.body.classList.remove('playing');
                updateNotification('STOP');
                Android.stopAudio();
            }
        });

        // ÂÜçÁîüÊôÇÈñì„Å®„Ç∑„Éº„ÇØ„Éê„Éº„ÅÆÂêåÊúü
        audioPlayer.addEventListener('timeupdate', function() {
            const value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            seekBar.value = value;
            updateTimeDisplay();
            updateEqualizer();
            Android.updatePlaybackInfo(audioPlayer.currentTime, audioPlayer.duration, audioPlayer.paused ? 'PAUSE' : 'PLAY');
        });

        // „Ç∑„Éº„ÇØ„Éê„Éº„ÇíÊìç‰Ωú„Åó„Å¶ÂÜçÁîü‰ΩçÁΩÆ„ÇíÂ§âÊõ¥
        seekBar.addEventListener('input', function() {
            const newTime = (seekBar.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = newTime;
            Android.seekTo(newTime);
        });

        // ÂÜçÁîüÊôÇÈñì„Å®ÁèæÂú®„ÅÆÂÜçÁîü‰ΩçÁΩÆ„ÇíË°®Á§∫„Åô„Çã
        function updateTimeDisplay() {
            const currentTime = formatTime(audioPlayer.currentTime);
            const duration = formatTime(audioPlayer.duration);
            currentTimeDisplay.textContent = currentTime;
            durationDisplay.textContent = duration;
        }

        // ÊôÇÈñì„ÅÆÂΩ¢Âºè„ÇíMM:SS„Å´Â§âÊèõ„Åô„Çã
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ÂãïÁîª„ÅÆÈï∑„Åï„ÅåÊ±∫„Åæ„Å£„Åü„ÇâË°®Á§∫„Åô„Çã
        function updateDurationDisplay() {
            if (audioPlayer.duration) {
                const duration = formatTime(audioPlayer.duration);
                durationDisplay.textContent = duration;
                Android.setDuration(audioPlayer.duration);
            }
        }

        // ÂÜçÁîüÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
        function updateNotification(state) {
            switch (state) {
                case 'PLAY':
                    Android.playOrPause();
                    break;
                case 'PAUSE':
                    Android.playOrPause();
                    break;
                case 'STOP':
                    Android.stop();
                    break;
            }
        }

        // Ê≥¢ÂΩ¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆË°®Á§∫
        function showWaveAnimation() {
            waveAnimation.classList.remove('hidden');
            currentAnimation = animations[Math.floor(Math.random() * animations.length)];
            Array.from(waveAnimation.children).forEach((wave, index) => {
                wave.style.animation = `${currentAnimation}-animation 1s infinite ease-in-out`;
                wave.style.animationDelay = `${index * 0.2}s`;
            });
        }

        // Ê≥¢ÂΩ¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÈùûË°®Á§∫
        function hideWaveAnimation() {
            waveAnimation.classList.add('hidden');
        }

        // „Ç§„Ç≥„É©„Ç§„Ç∂„Éº„ÅÆÊõ¥Êñ∞
        function updateEqualizer() {
            const time = audioPlayer.currentTime;
            eq1.style.height = `${Math.sin(time) * 20 + 25}px`;
            eq2.style.height = `${Math.sin(time * 2) * 20 + 35}px`;
            eq3.style.height = `${Math.sin(time * 3) * 20 + 45}px`;
        }

        // ÂàùÊúüË®≠ÂÆö
        function checkPlaybackState() {
            if (audioPlayer.paused) {
                updateNotification('PAUSE');
            } else if (audioPlayer.ended) {
                updateNotification('STOP');
            } else {
                updateNotification('PLAY');
            }
        }

        // ÂÆöÊúüÁöÑ„Å´ÂÜçÁîüÁä∂ÊÖã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        setInterval(checkPlaybackState, 1000);

        // Java„Åã„Çâ„ÅÆÁä∂ÊÖãÊõ¥Êñ∞„ÇíÂèó„ÅëÂèñ„ÇãÈñ¢Êï∞
        function updateUIFromJava(state) {
            switch (state) {
                case 'PLAY':
                    audioPlayer.play();
                    document.body.classList.add('playing');
                    showWaveAnimation();
                    playBtn.textContent = '‚è∏ Pause';
                    break;
                case 'PAUSE':
                    audioPlayer.pause();
                    document.body.classList.remove('playing');
                    hideWaveAnimation();
                    playBtn.textContent = '‚ñ∂ Play';
                    break;
                case 'STOP':
                    audioPlayer.pause();
                    audioPlayer.currentTime = 0;
                    document.body.classList.remove('playing');
                    hideWaveAnimation();
                    playBtn.textContent = '‚ñ∂ Play';
                    break;
            }
        }
    </script>
</body>
</html>
