<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notification Data Provider</title>
</head>
<body>
    <script>
        // ファイル選択通知用の関数
        function onFileSelected(filePath) {
            Android.onFileSelected(filePath);
        }

        // 再生情報の更新を通知
        function updatePlaybackInfo(currentTime, duration, state) {
            Android.updatePlaybackInfo(currentTime, duration, state);
        }

        // 状態変更の通知
        function updateNotification(state) {
            switch (state) {
                case 'PLAY':
                    Android.playAudio();
                    break;
                case 'PAUSE':
                    Android.pauseAudio();
                    break;
                case 'STOP':
                    Android.stopAudio();
                    break;
            }
            Android.updatePlaybackInfo(getCurrentTime(), getDuration(), state);
        }

        // シークバーの更新を通知
        function seekTo(newTime) {
            Android.seekTo(newTime);
            Android.updatePlaybackInfo(newTime, getDuration(), 'PLAY');
        }

        // 再生時間を取得
        function getCurrentTime() {
            return document.getElementById('audioPlayer').currentTime;
        }

        // 総再生時間を取得
        function getDuration() {
            return document.getElementById('audioPlayer').duration;
        }

        // 再生時間を更新
        function updateTimeDisplay(timeString) {
            document.getElementById('currentTime').textContent = timeString;
            Android.updatePlaybackInfo(parseFloat(timeString), getDuration(), 'PLAY');
        }

        // 時間の形式をMM:SSに変換する
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // 総再生時間を設定
        function setDuration(duration) {
            document.getElementById('duration').textContent = formatTime(duration);
            Android.setDuration(duration);
        }

        // これらの関数は、player.htmlから呼び出されることを想定
        window.onFileSelected = onFileSelected;
        window.updateNotification = updateNotification;
        window.seekTo = seekTo;
        window.updateTimeDisplay = updateTimeDisplay;
        window.setDuration = setDuration;

        // 再生中、ポーズ、停止の状態をチェックして更新
        function checkPlaybackState() {
            const audioPlayer = document.getElementById('audioPlayer');
            if (audioPlayer.paused) {
                updateNotification('PAUSE');
            } else if (audioPlayer.ended) {
                updateNotification('STOP');
            } else {
                updateNotification('PLAY');
            }
        }

        // 定期的に再生状態をチェック
        setInterval(checkPlaybackState, 1000);

        // 再生終了後の処理
        document.getElementById('audioPlayer').addEventListener('ended', function() {
            updateNotification('STOP');
        });

        // シークバーの操作を監視
        document.getElementById('seekBar').addEventListener('input', function() {
            const newTime = this.value / 100 * getDuration();
            seekTo(newTime);
        });

        // 再生時間が更新されたときの処理
        document.getElementById('audioPlayer').addEventListener('timeupdate', function() {
            updateTimeDisplay(formatTime(this.currentTime));
        });
    </script>
</body>
</html>
